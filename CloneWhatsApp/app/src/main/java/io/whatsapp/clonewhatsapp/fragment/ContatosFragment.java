package io.whatsapp.clonewhatsapp.fragment;import android.content.Intent;import android.os.Bundle;import android.support.v4.app.Fragment;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.AdapterView;import android.widget.ArrayAdapter;import android.widget.ListView;import com.google.firebase.database.DataSnapshot;import com.google.firebase.database.DatabaseError;import com.google.firebase.database.DatabaseReference;import com.google.firebase.database.ValueEventListener;import java.util.ArrayList;import io.whatsapp.clonewhatsapp.ConversaActivity;import io.whatsapp.clonewhatsapp.R;import io.whatsapp.clonewhatsapp.adapter.ContatoAdapter;import io.whatsapp.clonewhatsapp.firebase.ConfigFireBase;import io.whatsapp.clonewhatsapp.helpers.Preferencias;import io.whatsapp.clonewhatsapp.model.Contato;/** * A simple {@link Fragment} subclass. */public class ContatosFragment extends Fragment {    private ListView lista_contatos;    private ArrayAdapter adapter;    private ArrayList<Contato> contatos;    private DatabaseReference firebase;    private ValueEventListener valueEventListenerContatos;    public ContatosFragment() {        // Required empty public constructor    }    @Override    public void onStart() {        super.onStart();        firebase.addValueEventListener( valueEventListenerContatos );    }    @Override    public void onStop() {        super.onStop();        firebase.removeEventListener( valueEventListenerContatos );    }    @Override    public View onCreateView(LayoutInflater inflater, ViewGroup container,                             Bundle savedInstanceState) {        contatos = new ArrayList<>();        // Inflate the layout for this fragment        View v = inflater.inflate(R.layout.fragment_contatos, container, false);        lista_contatos = (ListView) v.findViewById(R.id.lista_contatos);        /*adapter = new ArrayAdapter(                getActivity(),                R.layout.lista_contatos,                contatos        );        */        adapter = new ContatoAdapter(getActivity(), contatos);        lista_contatos.setAdapter( adapter );        //recuperando o identificador para setar na listview        Preferencias p = new Preferencias( getActivity() );        String uidUserLogado = p.getIdentificador();        firebase = ConfigFireBase.getFirebase()        .child("contatos")        .child( uidUserLogado );        valueEventListenerContatos = new ValueEventListener() {            @Override            public void onDataChange(DataSnapshot dataSnapshot) {                //limpando lista                contatos.clear();                //listando contatos                for (DataSnapshot data : dataSnapshot.getChildren() ){                    Contato contato = data.getValue( Contato.class );                    contatos.add( contato );                }                adapter.notifyDataSetChanged();            }            @Override            public void onCancelled(DatabaseError databaseError) {            }        };        lista_contatos.setOnItemClickListener(new AdapterView.OnItemClickListener() {            @Override            public void onItemClick(AdapterView<?> adapterView, View view, int i, long l) {                Intent intent = new Intent(getActivity(), ConversaActivity.class);                startActivity( intent );            }        });        return v;    }}